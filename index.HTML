<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æœåŠ¡è®°å½•ç»Ÿè®¡åˆ†æ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', 'Microsoft YaHei', sans-serif;
        }
        
        body {
            background-color: #f5f7fa;
            color: #333;
            line-height: 1.6;
            padding: 20px;
            font-size: 14px;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background-color: white;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
            overflow: hidden;
        }
        
        header {
            background: linear-gradient(135deg, #1a73e8 0%, #6c8ef5 100%);
            color: white;
            padding: 25px 30px;
            border-bottom: 1px solid #e0e0e0;
        }
        
        header h1 {
            font-size: 24px;
            margin-bottom: 5px;
        }
        
        header p {
            opacity: 0.9;
            font-size: 14px;
        }
        
        .main-content {
            display: flex;
            min-height: 600px;
        }
        
        .sidebar {
            width: 300px;
            background-color: #f9fafc;
            border-right: 1px solid #eaeaea;
            padding: 20px;
        }
        
        .content {
            flex: 1;
            padding: 20px;
        }
        
        .section-title {
            font-size: 18px;
            color: #1a73e8;
            margin-bottom: 15px;
            padding-bottom: 8px;
            border-bottom: 2px solid #eaeaea;
        }
        
        .form-group {
            margin-bottom: 16px;
        }
        
        .form-group label {
            display: block;
            font-weight: 600;
            margin-bottom: 6px;
            color: #555;
            font-size: 13px;
        }
        
        .form-control {
            width: 100%;
            padding: 9px 12px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 13px;
            transition: border 0.3s;
        }
        
        .form-control:focus {
            border-color: #1a73e8;
            outline: none;
            box-shadow: 0 0 0 2px rgba(26, 115, 232, 0.2);
        }
        
        .input-with-button {
            display: flex;
            gap: 5px;
        }
        
        .input-with-button .form-control {
            flex: 1;
        }
        
        .btn-input {
            background-color: #1a73e8;
            color: white;
            border: none;
            border-radius: 5px;
            padding: 0 12px;
            cursor: pointer;
            font-weight: 600;
            transition: background-color 0.3s;
            font-size: 13px;
        }
        
        .btn-input:hover {
            background-color: #0d62d9;
        }
        
        .date-range {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        
        .date-range span {
            color: #777;
            text-align: center;
            margin: 5px 0;
            font-size: 13px;
        }
        
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: 600;
            font-size: 13px;
            transition: all 0.3s;
        }
        
        .btn-primary {
            background-color: #1a73e8;
            color: white;
        }
        
        .btn-primary:hover {
            background-color: #0d62d9;
        }
        
        .btn-secondary {
            background-color: #f1f3f4;
            color: #333;
        }
        
        .btn-secondary:hover {
            background-color: #e3e6e8;
        }
        
        .btn-block {
            display: block;
            width: 100%;
        }
        
        .button-group {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }
        
        .statistics-summary {
            display: flex;
            justify-content: space-between;
            margin-bottom: 15px;
            flex-wrap: wrap;
            gap: 12px;
        }
        
        .summary-card {
            background-color: #f8f9fa;
            border-radius: 8px;
            padding: 12px;
            flex: 1;
            min-width: 180px;
            border-left: 4px solid #1a73e8;
        }
        
        .summary-card.department {
            border-left-color: #34a853;
        }
        
        .summary-card.operator {
            border-left-color: #9c27b0;
        }
        
        .summary-card.records {
            border-left-color: #fbbc04;
        }
        
        .summary-card.empty {
            border-left-color: #ea4335;
        }
        
        .summary-title {
            font-size: 12px;
            color: #666;
            margin-bottom: 6px;
        }
        
        .summary-value {
            font-size: 20px;
            font-weight: 700;
            color: #1a73e8;
        }
        
        .summary-card.department .summary-value {
            color: #34a853;
        }
        
        .summary-card.operator .summary-value {
            color: #9c27b0;
        }
        
        .summary-card.records .summary-value {
            color: #fbbc04;
        }
        
        .summary-card.empty .summary-value {
            color: #ea4335;
        }
        
        .statistics-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
            font-size: 13px;
        }
        
        .statistics-table th {
            background-color: #f1f3f4;
            padding: 12px 10px;
            text-align: left;
            font-weight: 600;
            color: #555;
            border-bottom: 2px solid #ddd;
            font-size: 13px;
        }
        
        .statistics-table td {
            padding: 12px 10px;
            border-bottom: 1px solid #eee;
        }
        
        .statistics-table tr:hover {
            background-color: #f9f9f9;
        }
        
        .percentage-cell {
            font-weight: 600;
            text-align: center;
        }
        
        .percentage-high {
            color: #34a853;
        }
        
        .percentage-medium {
            color: #fbbc04;
        }
        
        .percentage-low {
            color: #ea4335;
        }
        
        .no-data {
            text-align: center;
            padding: 40px 20px;
            color: #777;
            font-size: 14px;
        }
        
        .no-data i {
            font-size: 40px;
            margin-bottom: 15px;
            color: #ccc;
        }
        
        /* æ ‘å½¢é€‰æ‹©æ¨¡æ€æ¡†æ ·å¼ */
        .tree-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }
        
        .modal-content {
            background-color: white;
            width: 90%;
            max-width: 600px;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            max-height: 80vh;
            overflow-y: auto;
        }
        
        .modal-header {
            background-color: #1a73e8;
            color: white;
            padding: 18px 25px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .modal-header h2 {
            font-size: 20px;
        }
        
        .close-btn {
            background: none;
            border: none;
            color: white;
            font-size: 24px;
            cursor: pointer;
            line-height: 1;
            padding: 0;
            width: 28px;
            height: 28px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: transform 0.2s;
        }
        
        .close-btn:hover {
            transform: scale(1.1);
        }
        
        .modal-body {
            padding: 20px;
            font-size: 13px;
        }
        
        /* æ ‘å½¢ç»“æ„æ ·å¼ */
        .tree-container {
            max-height: 400px;
            overflow-y: auto;
            border: 1px solid #eee;
            border-radius: 5px;
            padding: 10px;
        }
        
        .tree-list {
            list-style: none;
            padding-left: 0;
        }
        
        .tree-list ul {
            list-style: none;
            padding-left: 20px;
        }
        
        .tree-item {
            padding: 7px 8px;
            margin: 2px 0;
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.2s;
            font-size: 13px;
        }
        
        .tree-item:hover {
            background-color: #f0f7ff;
        }
        
        .tree-item.selected {
            background-color: #e3f2fd;
            font-weight: 600;
            color: #1a73e8;
        }
        
        .tree-item .toggle {
            display: inline-block;
            width: 18px;
            text-align: center;
            margin-right: 5px;
            font-weight: bold;
            font-size: 13px;
        }
        
        .tree-item .icon {
            display: inline-block;
            width: 18px;
            text-align: center;
            margin-right: 5px;
            font-size: 13px;
        }
        
        .tree-search {
            margin-bottom: 15px;
        }
        
        .tree-search input {
            width: 100%;
            padding: 9px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 13px;
        }
        
        @media (max-width: 1200px) {
            .main-content {
                flex-direction: column;
            }
            
            .sidebar {
                width: 100%;
                border-right: none;
                border-bottom: 1px solid #eaeaea;
            }
            
            .statistics-summary {
                flex-direction: column;
            }
        }
        
        @media (max-width: 768px) {
            .statistics-table {
                display: block;
                overflow-x: auto;
            }
            
            .date-range {
                flex-direction: column;
            }
            
            .input-with-button {
                flex-direction: column;
            }
            
            .input-with-button .btn-input {
                width: 100%;
                padding: 9px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>æœåŠ¡è®°å½•ç»Ÿè®¡åˆ†æ</h1>
            <p>æŒ‰éƒ¨é—¨æˆ–æ“ä½œå‘˜ç»Ÿè®¡æœåŠ¡è®°å½•æƒ…å†µ</p>
        </header>
        
        <div class="main-content">
            <div class="sidebar">
                <h2 class="section-title">æŸ¥è¯¢æ¡ä»¶</h2>
                
                <div class="form-group">
                    <label for="address">åœ°å€</label>
                    <div class="input-with-button">
                        <input type="text" id="address" class="form-control" placeholder="ç‚¹å‡»é€‰æ‹©åœ°å€" readonly>
                        <button class="btn-input" onclick="showTreeModal('address')">é€‰æ‹©</button>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="department">æ“ä½œå‘˜éƒ¨é—¨</label>
                    <div class="input-with-button">
                        <input type="text" id="department" class="form-control" placeholder="ç‚¹å‡»é€‰æ‹©éƒ¨é—¨" readonly>
                        <button class="btn-input" onclick="showTreeModal('department')">é€‰æ‹©</button>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="operator">æ“ä½œå‘˜</label>
                    <div class="input-with-button">
                        <input type="text" id="operator" class="form-control" placeholder="ç‚¹å‡»é€‰æ‹©æ“ä½œå‘˜" readonly>
                        <button class="btn-input" onclick="showTreeModal('operator')">é€‰æ‹©</button>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="dateRange">ç»Ÿè®¡æ—¶é—´æ®µ</label>
                    <div class="date-range">
                        <input type="date" id="startDate" class="form-control" value="2025-10-01">
                        <span>è‡³</span>
                        <input type="date" id="endDate" class="form-control" value="2025-10-31">
                    </div>
                </div>
                
                <div class="button-group">
                    <button class="btn btn-primary btn-block" onclick="queryStatistics()">æŸ¥è¯¢ç»Ÿè®¡</button>
                    <button class="btn btn-secondary btn-block" onclick="resetForm()">é‡ç½®æ¡ä»¶</button>
                </div>
            </div>
            
            <div class="content">
                <h2 class="section-title">ç»Ÿè®¡ç»“æœ</h2>
                
                <div class="statistics-summary" id="statisticsSummary">
                    <!-- ç»Ÿè®¡æ‘˜è¦ä¿¡æ¯å°†åœ¨è¿™é‡ŒåŠ¨æ€ç”Ÿæˆ -->
                </div>
                
                <div class="table-container">
                    <table class="statistics-table" id="departmentTable">
                        <thead>
                            <tr>
                                <th>éƒ¨é—¨</th>
                                <th>å—ç†å•å®¢æˆ·æ•°</th>
                                <th>æœ‰æœåŠ¡ç•™ç—•æ•°</th>
                                <th>æ— æœåŠ¡ç•™ç—•æ•°</th>
                                <th>æœåŠ¡ç•™ç—•ç‡</th>
                                <th>å¹³å‡æœåŠ¡æ—¶é•¿</th>
                            </tr>
                        </thead>
                        <tbody id="departmentBody">
                            <!-- éƒ¨é—¨ç»Ÿè®¡æ•°æ®å°†åœ¨è¿™é‡ŒåŠ¨æ€ç”Ÿæˆ -->
                        </tbody>
                    </table>
                    
                    <table class="statistics-table" id="operatorTable" style="display: none;">
                        <thead>
                            <tr>
                                <th>éƒ¨é—¨</th>
                                <th>æ“ä½œå‘˜</th>
                                <th>å—ç†å•å®¢æˆ·æ•°</th>
                                <th>æœ‰æœåŠ¡ç•™ç—•æ•°</th>
                                <th>æ— æœåŠ¡ç•™ç—•æ•°</th>
                                <th>æœåŠ¡ç•™ç—•ç‡</th>
                                <th>å¹³å‡æœåŠ¡æ—¶é•¿</th>
                            </tr>
                        </thead>
                        <tbody id="operatorBody">
                            <!-- æ“ä½œå‘˜ç»Ÿè®¡æ•°æ®å°†åœ¨è¿™é‡ŒåŠ¨æ€ç”Ÿæˆ -->
                        </tbody>
                    </table>
                </div>
                
                <div class="no-data" id="noDataMessage">
                    <div>ğŸ“Š</div>
                    <h3>æš‚æ— ç»Ÿè®¡æ•°æ®</h3>
                    <p>è¯·è®¾ç½®æŸ¥è¯¢æ¡ä»¶å¹¶ç‚¹å‡»"æŸ¥è¯¢ç»Ÿè®¡"æŒ‰é’®æŸ¥çœ‹ç»“æœ</p>
                </div>
            </div>
        </div>
    </div>
    
    <!-- æ ‘å½¢é€‰æ‹©æ¨¡æ€æ¡† -->
    <div class="tree-modal" id="treeModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="treeModalTitle">é€‰æ‹©</h2>
                <button class="close-btn" onclick="closeModal('treeModal')">&times;</button>
            </div>
            <div class="modal-body">
                <div class="tree-search">
                    <input type="text" id="treeSearch" placeholder="æœç´¢..." onkeyup="filterTree()">
                </div>
                <div class="tree-container">
                    <ul class="tree-list" id="treeList">
                        <!-- æ ‘å½¢ç»“æ„å°†åœ¨è¿™é‡ŒåŠ¨æ€ç”Ÿæˆ -->
                    </ul>
                </div>
                <div style="margin-top: 20px; text-align: right;">
                    <button class="btn btn-secondary" onclick="closeModal('treeModal')">å–æ¶ˆ</button>
                    <button class="btn btn-primary" onclick="confirmTreeSelection()" style="margin-left: 10px;">ç¡®å®š</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // æ¨¡æ‹Ÿæ•°æ® - ç»Ÿè®¡ç›¸å…³æ•°æ®
        const mockStatisticsData = {
            // éƒ¨é—¨ç»Ÿè®¡æ•°æ®
            departmentStats: [
                {
                    department: "å’Œå¹³æ²³è¥¿åˆ†å…¬å¸",
                    totalOrders: 156,
                    withRecords: 142,
                    withoutRecords: 14,
                    avgDuration: 85,
                    operators: 8,
                    recordRate: 67.0
                },
                {
                    department: "æ»¨æµ·åˆ†å…¬å¸",
                    totalOrders: 203,
                    withRecords: 188,
                    withoutRecords: 15,
                    avgDuration: 92,
                    operators: 12,
                    recordRate: 92.6
                },
                {
                    department: "åŸè¥¿åˆ†å…¬å¸",
                    totalOrders: 134,
                    withRecords: 121,
                    withoutRecords: 13,
                    avgDuration: 78,
                    operators: 9,
                    recordRate: 45.3
                },
                {
                    department: "å®æ²³åˆ†å…¬å¸",
                    totalOrders: 87,
                    withRecords: 82,
                    withoutRecords: 5,
                    avgDuration: 95,
                    operators: 6,
                    recordRate: 94.3
                },
                {
                    department: "ä¸œä¸½åˆ†å…¬å¸",
                    totalOrders: 112,
                    withRecords: 105,
                    withoutRecords: 7,
                    avgDuration: 88,
                    operators: 7,
                    recordRate: 93.8
                },
                {
                    department: "åŒ—è¾°åˆ†å…¬å¸",
                    totalOrders: 95,
                    withRecords: 86,
                    withoutRecords: 9,
                    avgDuration: 81,
                    operators: 8,
                    recordRate: 45.5
                }
            ],
            
            // æ“ä½œå‘˜ç»Ÿè®¡æ•°æ®
            operatorStats: [
                {
                    department: "å’Œå¹³æ²³è¥¿åˆ†å…¬å¸",
                    operator: "å¼ ä¸‰ (520111xlx)",
                    totalOrders: 42,
                    withRecords: 40,
                    withoutRecords: 2,
                    avgDuration: 87,
                    recordRate: 95.2
                },
                {
                    department: "å’Œå¹³æ²³è¥¿åˆ†å…¬å¸",
                    operator: "æä¸½ (520115ll)",
                    totalOrders: 38,
                    withRecords: 36,
                    withoutRecords: 2,
                    avgDuration: 83,
                    recordRate: 94.7
                },
                {
                    department: "å’Œå¹³æ²³è¥¿åˆ†å…¬å¸",
                    operator: "ç‹æ˜ (520116wm)",
                    totalOrders: 32,
                    withRecords: 30,
                    withoutRecords: 2,
                    avgDuration: 85,
                    recordRate: 93.8
                },
                {
                    department: "æ»¨æµ·åˆ†å…¬å¸",
                    operator: "èµµåˆš (520117zg)",
                    totalOrders: 48,
                    withRecords: 46,
                    withoutRecords: 2,
                    avgDuration: 94,
                    recordRate: 95.8
                },
                {
                    department: "æ»¨æµ·åˆ†å…¬å¸",
                    operator: "åˆ˜èŠ³ (520118lf)",
                    totalOrders: 45,
                    withRecords: 43,
                    withoutRecords: 2,
                    avgDuration: 90,
                    recordRate: 95.6
                },
                {
                    department: "æ»¨æµ·åˆ†å…¬å¸",
                    operator: "å‘¨æ¶› (520119zt)",
                    totalOrders: 40,
                    withRecords: 37,
                    withoutRecords: 3,
                    avgDuration: 95,
                    recordRate: 92.5
                },
                {
                    department: "åŸè¥¿åˆ†å…¬å¸",
                    operator: "å´å (520120wh)",
                    totalOrders: 38,
                    withRecords: 35,
                    withoutRecords: 3,
                    avgDuration: 79,
                    recordRate: 92.1
                },
                {
                    department: "åŸè¥¿åˆ†å…¬å¸",
                    operator: "éƒ‘ä¸½ (520121zl)",
                    totalOrders: 36,
                    withRecords: 33,
                    withoutRecords: 3,
                    avgDuration: 76,
                    recordRate: 67.7
                },
                {
                    department: "åŸè¥¿åˆ†å…¬å¸",
                    operator: "å­™ä¼Ÿ (520122sw)",
                    totalOrders: 32,
                    withRecords: 29,
                    withoutRecords: 3,
                    avgDuration: 80,
                    recordRate: 45.6
                },
                {
                    department: "å®æ²³åˆ†å…¬å¸",
                    operator: "é’±å‹‡ (520123qy)",
                    totalOrders: 30,
                    withRecords: 29,
                    withoutRecords: 1,
                    avgDuration: 97,
                    recordRate: 96.7
                },
                {
                    department: "å®æ²³åˆ†å…¬å¸",
                    operator: "å†¯é™ (520124fj)",
                    totalOrders: 29,
                    withRecords: 28,
                    withoutRecords: 1,
                    avgDuration: 92,
                    recordRate: 96.6
                },
                {
                    department: "ä¸œä¸½åˆ†å…¬å¸",
                    operator: "é™ˆæ˜ (520125cm)",
                    totalOrders: 36,
                    withRecords: 34,
                    withoutRecords: 2,
                    avgDuration: 86,
                    recordRate: 94.4
                },
                {
                    department: "ä¸œä¸½åˆ†å…¬å¸",
                    operator: "æ¨æ´‹ (520126yy)",
                    totalOrders: 34,
                    withRecords: 33,
                    withoutRecords: 1,
                    avgDuration: 90,
                    recordRate: 97.1
                },
                {
                    department: "åŒ—è¾°åˆ†å…¬å¸",
                    operator: "æœ±å†› (520127zj)",
                    totalOrders: 32,
                    withRecords: 29,
                    withoutRecords: 3,
                    avgDuration: 82,
                    recordRate: 45.6
                },
                {
                    department: "åŒ—è¾°åˆ†å…¬å¸",
                    operator: "ç§¦èŠ³ (520128qf)",
                    totalOrders: 31,
                    withRecords: 28,
                    withoutRecords: 3,
                    avgDuration: 80,
                    recordRate: 45.3
                }
            ],
            
            // åœ°å€ç›¸å…³çš„ç»Ÿè®¡æ•°æ®
            addressStats: {
                "å—å¼€åŒº": {
                    departmentStats: [
                        {
                            department: "å’Œå¹³æ²³è¥¿åˆ†å…¬å¸",
                            totalOrders: 45,
                            withRecords: 42,
                            withoutRecords: 3,
                            avgDuration: 82,
                            recordRate: 93.3
                        },
                        {
                            department: "åŸè¥¿åˆ†å…¬å¸",
                            totalOrders: 38,
                            withRecords: 35,
                            withoutRecords: 3,
                            avgDuration: 79,
                            recordRate: 92.1
                        }
                    ],
                    operatorStats: [
                        {
                            department: "å’Œå¹³æ²³è¥¿åˆ†å…¬å¸",
                            operator: "å¼ ä¸‰ (520111xlx)",
                            totalOrders: 25,
                            withRecords: 24,
                            withoutRecords: 1,
                            avgDuration: 85,
                            recordRate: 96.0
                        },
                        {
                            department: "åŸè¥¿åˆ†å…¬å¸",
                            operator: "å´å (520120wh)",
                            totalOrders: 22,
                            withRecords: 20,
                            withoutRecords: 2,
                            avgDuration: 78,
                            recordRate: 45.9
                        }
                    ]
                },
                "æ²³è¥¿åŒº": {
                    departmentStats: [
                        {
                            department: "æ»¨æµ·åˆ†å…¬å¸",
                            totalOrders: 52,
                            withRecords: 50,
                            withoutRecords: 2,
                            avgDuration: 91,
                            recordRate: 96.2
                        }
                    ],
                    operatorStats: [
                        {
                            department: "æ»¨æµ·åˆ†å…¬å¸",
                            operator: "èµµåˆš (520117zg)",
                            totalOrders: 28,
                            withRecords: 27,
                            withoutRecords: 1,
                            avgDuration: 92,
                            recordRate: 96.4
                        },
                        {
                            department: "æ»¨æµ·åˆ†å…¬å¸",
                            operator: "åˆ˜èŠ³ (520118lf)",
                            totalOrders: 24,
                            withRecords: 23,
                            withoutRecords: 1,
                            avgDuration: 90,
                            recordRate: 95.8
                        }
                    ]
                },
                "å’Œå¹³åŒº": {
                    departmentStats: [
                        {
                            department: "å’Œå¹³æ²³è¥¿åˆ†å…¬å¸",
                            totalOrders: 48,
                            withRecords: 45,
                            withoutRecords: 3,
                            avgDuration: 85,
                            recordRate: 93.8
                        }
                    ],
                    operatorStats: [
                        {
                            department: "å’Œå¹³æ²³è¥¿åˆ†å…¬å¸",
                            operator: "æä¸½ (520115ll)",
                            totalOrders: 26,
                            withRecords: 25,
                            withoutRecords: 1,
                            avgDuration: 84,
                            recordRate: 96.2
                        },
                        {
                            department: "å’Œå¹³æ²³è¥¿åˆ†å…¬å¸",
                            operator: "ç‹æ˜ (520116wm)",
                            totalOrders: 22,
                            withRecords: 20,
                            withoutRecords: 2,
                            avgDuration: 86,
                            recordRate: 45.9
                        }
                    ]
                },
                "æ²³ä¸œåŒº": {
                    departmentStats: [
                        {
                            department: "å®æ²³åˆ†å…¬å¸",
                            totalOrders: 35,
                            withRecords: 33,
                            withoutRecords: 2,
                            avgDuration: 89,
                            recordRate: 94.3
                        }
                    ],
                    operatorStats: [
                        {
                            department: "å®æ²³åˆ†å…¬å¸",
                            operator: "é’±å‹‡ (520123qy)",
                            totalOrders: 20,
                            withRecords: 19,
                            withoutRecords: 1,
                            avgDuration: 88,
                            recordRate: 95.0
                        }
                    ]
                },
                "æ²³åŒ—åŒº": {
                    departmentStats: [
                        {
                            department: "åŒ—è¾°åˆ†å…¬å¸",
                            totalOrders: 42,
                            withRecords: 38,
                            withoutRecords: 4,
                            avgDuration: 83,
                            recordRate: 45.5
                        }
                    ],
                    operatorStats: [
                        {
                            department: "åŒ—è¾°åˆ†å…¬å¸",
                            operator: "æœ±å†› (520127zj)",
                            totalOrders: 22,
                            withRecords: 20,
                            withoutRecords: 2,
                            avgDuration: 82,
                            recordRate: 45.9
                        }
                    ]
                }
            }
        };

        // æ ‘å½¢ç»“æ„æ•°æ®
        const treeData = {
            address: {
                title: "é€‰æ‹©åœ°å€",
                items: [
                    {
                        id: "area1",
                        name: "å—å¼€åŒº",
                        children: [
                            { id: "area1-1", name: "å—å¼€åŒºåè‹‘è¡—" },
                            { id: "area1-2", name: "å—å¼€åŒºå­¦åºœè¡—" },
                            { id: "area1-3", name: "å—å¼€åŒºæ°´ä¸Šå…¬å›­è¡—" }
                        ]
                    },
                    {
                        id: "area2",
                        name: "æ²³è¥¿åŒº",
                        children: [
                            { id: "area2-1", name: "æ²³è¥¿åŒºä¸‹ç“¦æˆ¿è¡—" },
                            { id: "area2-2", name: "æ²³è¥¿åŒºå‹è°Šè·¯è¡—" },
                            { id: "area2-3", name: "æ²³è¥¿åŒºæ¢…æ±Ÿè¡—" }
                        ]
                    },
                    {
                        id: "area3",
                        name: "å’Œå¹³åŒº",
                        children: [
                            { id: "area3-1", name: "å’Œå¹³åŒºåŠä¸šåœºè¡—" },
                            { id: "area3-2", name: "å’Œå¹³åŒºäº”å¤§é“è¡—" }
                        ]
                    },
                    {
                        id: "area4",
                        name: "æ²³ä¸œåŒº",
                        children: [
                            { id: "area4-1", name: "æ²³ä¸œåŒºå¤§ç‹åº„è¡—" },
                            { id: "area4-2", name: "æ²³ä¸œåŒºä¸­å±±é—¨è¡—" }
                        ]
                    },
                    {
                        id: "area5",
                        name: "æ²³åŒ—åŒº",
                        children: [
                            { id: "area5-1", name: "æ²³åŒ—åŒºå…‰å¤é“è¡—" },
                            { id: "area5-2", name: "æ²³åŒ—åŒºæœ›æµ·æ¥¼è¡—" }
                        ]
                    }
                ]
            },
            department: {
                title: "é€‰æ‹©éƒ¨é—¨",
                items: [
                    {
                        id: "dept1",
                        name: "å’Œå¹³æ²³è¥¿åˆ†å…¬å¸",
                        children: [
                            { id: "dept1-1", name: "å’Œå¹³æ²³å—è·¯è¥ä¸šå…" },
                            { id: "dept1-2", name: "æ²³è¥¿åˆ©æ°‘é“è¥ä¸šå…" }
                        ]
                    },
                    {
                        id: "dept2",
                        name: "æ»¨æµ·åˆ†å…¬å¸",
                        children: [
                            { id: "dept2-1", name: "å¡˜æ²½ä¸Šæµ·é“è¥ä¸šå…" },
                            { id: "dept2-2", name: "å¤§æ¸¯æ°¸æ˜è·¯è¥ä¸šå…" },
                            { id: "dept2-3", name: "æ±‰æ²½è¥ä¸šå…" }
                        ]
                    },
                    {
                        id: "dept3",
                        name: "åŸè¥¿åˆ†å…¬å¸",
                        children: [
                            { id: "dept3-1", name: "è¥¿é’è¥ä¸šå…" },
                            { id: "dept3-2", name: "é™æµ·è¥ä¸šå…" }
                        ]
                    },
                    {
                        id: "dept4",
                        name: "å®æ²³åˆ†å…¬å¸",
                        children: [
                            { id: "dept4-1", name: "å®æ²³è¥ä¸šå…" }
                        ]
                    },
                    {
                        id: "dept5",
                        name: "ä¸œä¸½åˆ†å…¬å¸",
                        children: [
                            { id: "dept5-1", name: "ä¸œä¸½è¥ä¸šå…" }
                        ]
                    },
                    {
                        id: "dept6",
                        name: "åŒ—è¾°åˆ†å…¬å¸",
                        children: [
                            { id: "dept6-1", name: "åŒ—è¾°è¥ä¸šå…" }
                        ]
                    }
                ]
            },
            operator: {
                title: "é€‰æ‹©æ“ä½œå‘˜",
                items: [
                    {
                        id: "op1",
                        name: "å’Œå¹³æ²³è¥¿åˆ†å…¬å¸",
                        children: [
                            { id: "op1-1", name: "å¼ ä¸‰ (520111xlx)" },
                            { id: "op1-2", name: "æä¸½ (520115ll)" },
                            { id: "op1-3", name: "ç‹æ˜ (520116wm)" }
                        ]
                    },
                    {
                        id: "op2",
                        name: "æ»¨æµ·åˆ†å…¬å¸",
                        children: [
                            { id: "op2-1", name: "èµµåˆš (520117zg)" },
                            { id: "op2-2", name: "åˆ˜èŠ³ (520118lf)" },
                            { id: "op2-3", name: "å‘¨æ¶› (520119zt)" }
                        ]
                    },
                    {
                        id: "op3",
                        name: "åŸè¥¿åˆ†å…¬å¸",
                        children: [
                            { id: "op3-1", name: "å´å (520120wh)" },
                            { id: "op3-2", name: "éƒ‘ä¸½ (520121zl)" },
                            { id: "op3-3", name: "å­™ä¼Ÿ (520122sw)" }
                        ]
                    },
                    {
                        id: "op4",
                        name: "å®æ²³åˆ†å…¬å¸",
                        children: [
                            { id: "op4-1", name: "é’±å‹‡ (520123qy)" },
                            { id: "op4-2", name: "å†¯é™ (520124fj)" }
                        ]
                    },
                    {
                        id: "op5",
                        name: "ä¸œä¸½åˆ†å…¬å¸",
                        children: [
                            { id: "op5-1", name: "é™ˆæ˜ (520125cm)" },
                            { id: "op5-2", name: "æ¨æ´‹ (520126yy)" }
                        ]
                    },
                    {
                        id: "op6",
                        name: "åŒ—è¾°åˆ†å…¬å¸",
                        children: [
                            { id: "op6-1", name: "æœ±å†› (520127zj)" },
                            { id: "op6-2", name: "ç§¦èŠ³ (520128qf)" }
                        ]
                    }
                ]
            }
        };

        // å…¨å±€å˜é‡
        let currentTreeType = '';
        let selectedTreeItem = null;

        // é¡µé¢åŠ è½½æ—¶æ˜¾ç¤ºé»˜è®¤ç»Ÿè®¡æ•°æ®
        document.addEventListener('DOMContentLoaded', function() {
            // é»˜è®¤æ˜¾ç¤ºéƒ¨é—¨ç»Ÿè®¡è¡¨æ ¼
            document.getElementById('departmentTable').style.display = 'table';
            document.getElementById('operatorTable').style.display = 'none';
            
            // æ˜¾ç¤ºéƒ¨é—¨ç»Ÿè®¡æ•°æ®
            displayDepartmentStats(mockStatisticsData.departmentStats);
            updateSummaryStats(mockStatisticsData.departmentStats, 'department');
        });

        // æ˜¾ç¤ºæ ‘å½¢é€‰æ‹©æ¨¡æ€æ¡†
        function showTreeModal(type) {
            currentTreeType = type;
            selectedTreeItem = null;
            
            document.getElementById('treeModalTitle').textContent = treeData[type].title;
            document.getElementById('treeSearch').value = '';
            generateTree(treeData[type].items);
            document.getElementById('treeModal').style.display = 'flex';
        }

        // ç”Ÿæˆæ ‘å½¢ç»“æ„
        function generateTree(items, parentElement = null) {
            const treeList = parentElement || document.getElementById('treeList');
            treeList.innerHTML = '';
            
            items.forEach(item => {
                const li = document.createElement('li');
                li.className = 'tree-item';
                li.dataset.id = item.id;
                li.dataset.name = item.name;
                
                let html = '';
                if (item.children && item.children.length > 0) {
                    html = `
                        <div>
                            <span class="toggle" onclick="toggleTreeItem(this)">+</span>
                            <span class="icon">ğŸ“</span>
                            <span class="name">${item.name}</span>
                        </div>
                    `;
                    
                    li.innerHTML = html;
                    
                    // åˆ›å»ºå­èŠ‚ç‚¹å®¹å™¨
                    const childUl = document.createElement('ul');
                    childUl.style.display = 'none';
                    li.appendChild(childUl);
                    
                    // ä¸ºæ•´ä¸ªdivæ·»åŠ ç‚¹å‡»äº‹ä»¶ï¼ˆé€‰æ‹©èŠ‚ç‚¹ï¼‰
                    li.querySelector('div').onclick = function(e) {
                        // å¦‚æœç‚¹å‡»çš„æ˜¯toggleæŒ‰é’®ï¼Œä¸è§¦å‘é€‰æ‹©
                        if (e.target.classList.contains('toggle')) return;
                        selectTreeItem(li);
                    };
                    
                    // é€’å½’ç”Ÿæˆå­èŠ‚ç‚¹
                    generateTree(item.children, childUl);
                } else {
                    html = `
                        <div>
                            <span class="toggle"></span>
                            <span class="icon">ğŸ“„</span>
                            <span class="name">${item.name}</span>
                        </div>
                    `;
                    li.innerHTML = html;
                    
                    li.querySelector('div').onclick = function() {
                        selectTreeItem(li);
                    };
                }
                
                treeList.appendChild(li);
            });
        }

        // åˆ‡æ¢æ ‘å½¢èŠ‚ç‚¹å±•å¼€/æŠ˜å 
        function toggleTreeItem(toggleElement) {
            const parentLi = toggleElement.closest('li');
            const childUl = parentLi.querySelector('ul');
            
            if (childUl) {
                if (childUl.style.display === 'none') {
                    childUl.style.display = 'block';
                    toggleElement.textContent = '-';
                } else {
                    childUl.style.display = 'none';
                    toggleElement.textContent = '+';
                }
            }
        }

        // é€‰æ‹©æ ‘å½¢èŠ‚ç‚¹
        function selectTreeItem(itemElement) {
            document.querySelectorAll('.tree-item.selected').forEach(el => {
                el.classList.remove('selected');
            });
            
            itemElement.classList.add('selected');
            selectedTreeItem = {
                id: itemElement.dataset.id,
                name: itemElement.dataset.name
            };
        }

        // è¿‡æ»¤æ ‘å½¢èŠ‚ç‚¹
        function filterTree() {
            const searchText = document.getElementById('treeSearch').value.toLowerCase();
            const treeItems = document.querySelectorAll('.tree-item');
            
            treeItems.forEach(item => {
                const name = item.dataset.name.toLowerCase();
                if (name.includes(searchText)) {
                    item.style.display = '';
                    
                    let parent = item.parentElement;
                    while (parent && parent.classList.contains('tree-list')) {
                        const parentLi = parent.closest('li');
                        if (parentLi) {
                            const toggle = parentLi.querySelector('.toggle');
                            if (toggle && toggle.textContent === '+') {
                                toggleTreeItem(toggle);
                            }
                        }
                        parent = parent.parentElement;
                    }
                } else {
                    item.style.display = 'none';
                }
            });
        }

        // ç¡®è®¤æ ‘å½¢é€‰æ‹©
        function confirmTreeSelection() {
            if (selectedTreeItem) {
                if (currentTreeType === 'address') {
                    document.getElementById('address').value = selectedTreeItem.name;
                } else if (currentTreeType === 'department') {
                    document.getElementById('department').value = selectedTreeItem.name;
                } else if (currentTreeType === 'operator') {
                    document.getElementById('operator').value = selectedTreeItem.name;
                }
                
                closeModal('treeModal');
            } else {
                alert('è¯·å…ˆé€‰æ‹©ä¸€ä¸ªé€‰é¡¹');
            }
        }

        // æŸ¥è¯¢ç»Ÿè®¡æ•°æ®
        function queryStatistics() {
            const address = document.getElementById('address').value;
            const department = document.getElementById('department').value;
            const operator = document.getElementById('operator').value;
            const startDate = document.getElementById('startDate').value;
            const endDate = document.getElementById('endDate').value;
            
            // åˆ¤æ–­æ˜¾ç¤ºå“ªç§ç»Ÿè®¡
            let showOperatorTable = false;
            
            if (operator) {
                // å¦‚æœé€‰æ‹©äº†æ“ä½œå‘˜ï¼Œæ˜¾ç¤ºæ“ä½œå‘˜ç»Ÿè®¡
                showOperatorTable = true;
                const filteredStats = filterOperatorStats(address, department, operator, startDate, endDate);
                displayOperatorStats(filteredStats);
                updateSummaryStats(filteredStats, 'operator');
            } else if (department) {
                // å¦‚æœé€‰æ‹©äº†éƒ¨é—¨ï¼Œæ˜¾ç¤ºéƒ¨é—¨ç»Ÿè®¡
                showOperatorTable = false;
                const filteredStats = filterDepartmentStats(address, department, startDate, endDate);
                displayDepartmentStats(filteredStats);
                updateSummaryStats(filteredStats, 'department');
            } else {
                // å¦‚æœä»€ä¹ˆéƒ½æ²¡é€‰ï¼Œé»˜è®¤æ˜¾ç¤ºéƒ¨é—¨ç»Ÿè®¡
                showOperatorTable = false;
                const filteredStats = filterDepartmentStats(address, '', startDate, endDate);
                displayDepartmentStats(filteredStats);
                updateSummaryStats(filteredStats, 'department');
            }
            
            // æ˜¾ç¤º/éšè—å¯¹åº”çš„è¡¨æ ¼
            if (showOperatorTable) {
                document.getElementById('departmentTable').style.display = 'none';
                document.getElementById('operatorTable').style.display = 'table';
            } else {
                document.getElementById('departmentTable').style.display = 'table';
                document.getElementById('operatorTable').style.display = 'none';
            }
        }

        // ç­›é€‰éƒ¨é—¨ç»Ÿè®¡æ•°æ®
        function filterDepartmentStats(address, department, startDate, endDate) {
            let stats = [...mockStatisticsData.departmentStats];
            
            // å¦‚æœæœ‰åœ°å€æ¡ä»¶ï¼Œç­›é€‰åœ°å€ç›¸å…³æ•°æ®
            if (address) {
                // æ£€æŸ¥æ˜¯å¦ä¸ºåŒºçº§åœ°å€
                const isDistrict = address.includes("åŒº");
                let districtName = address;
                
                if (isDistrict) {
                    // å¦‚æœæ˜¯"æŸæŸåŒº"æ ¼å¼ï¼Œæå–åŒºå
                    districtName = address.replace("åŒº", "");
                    const addressData = mockStatisticsData.addressStats[districtName];
                    
                    if (addressData && addressData.departmentStats) {
                        stats = addressData.departmentStats;
                    }
                }
            }
            
            // å¦‚æœæœ‰éƒ¨é—¨æ¡ä»¶ï¼Œç­›é€‰éƒ¨é—¨
            if (department) {
                stats = stats.filter(stat => stat.department.includes(department));
            }
            
            return stats;
        }

        // ç­›é€‰æ“ä½œå‘˜ç»Ÿè®¡æ•°æ®
        function filterOperatorStats(address, department, operator, startDate, endDate) {
            let stats = [...mockStatisticsData.operatorStats];
            
            // å¦‚æœæœ‰åœ°å€æ¡ä»¶ï¼Œç­›é€‰åœ°å€ç›¸å…³æ•°æ®
            if (address) {
                // æ£€æŸ¥æ˜¯å¦ä¸ºåŒºçº§åœ°å€
                const isDistrict = address.includes("åŒº");
                let districtName = address;
                
                if (isDistrict) {
                    // å¦‚æœæ˜¯"æŸæŸåŒº"æ ¼å¼ï¼Œæå–åŒºå
                    districtName = address.replace("åŒº", "");
                    const addressData = mockStatisticsData.addressStats[districtName];
                    
                    if (addressData && addressData.operatorStats) {
                        stats = addressData.operatorStats;
                    }
                }
            }
            
            // å¦‚æœæœ‰éƒ¨é—¨æ¡ä»¶ï¼Œç­›é€‰éƒ¨é—¨
            if (department) {
                stats = stats.filter(stat => stat.department.includes(department));
            }
            
            // å¦‚æœæœ‰æ“ä½œå‘˜æ¡ä»¶ï¼Œç­›é€‰æ“ä½œå‘˜
            if (operator) {
                stats = stats.filter(stat => {
                    return stat.operator.includes(operator.split(' ')[0]) || 
                           stat.department.includes(operator);
                });
            }
            
            return stats;
        }

        // æ˜¾ç¤ºéƒ¨é—¨ç»Ÿè®¡æ•°æ®
        function displayDepartmentStats(stats) {
            const departmentBody = document.getElementById('departmentBody');
            const noDataMessage = document.getElementById('noDataMessage');
            
            if (stats.length === 0) {
                departmentBody.innerHTML = '';
                noDataMessage.style.display = 'block';
                return;
            }
            
            noDataMessage.style.display = 'none';
            
            let rowsHTML = '';
            stats.forEach(stat => {
                const recordRate = stat.recordRate.toFixed(1);
                let rateClass = 'percentage-high';
                if (recordRate < 85) {
                    rateClass = 'percentage-low';
                } else if (recordRate < 92) {
                    rateClass = 'percentage-medium';
                }
                
                rowsHTML += `
                    <tr>
                        <td><strong>${stat.department}</strong></td>
                        <td>${stat.totalOrders}</td>
                        <td>${stat.withRecords}</td>
                        <td>${stat.withoutRecords}</td>
                        <td class="percentage-cell ${rateClass}">${recordRate}%</td>
                        <td>${stat.avgDuration}åˆ†é’Ÿ</td>
                    </tr>
                `;
            });
            
            departmentBody.innerHTML = rowsHTML;
        }

        // æ˜¾ç¤ºæ“ä½œå‘˜ç»Ÿè®¡æ•°æ®
        function displayOperatorStats(stats) {
            const operatorBody = document.getElementById('operatorBody');
            const noDataMessage = document.getElementById('noDataMessage');
            
            if (stats.length === 0) {
                operatorBody.innerHTML = '';
                noDataMessage.style.display = 'block';
                return;
            }
            
            noDataMessage.style.display = 'none';
            
            let rowsHTML = '';
            stats.forEach(stat => {
                const recordRate = stat.recordRate.toFixed(1);
                let rateClass = 'percentage-high';
                if (recordRate < 85) {
                    rateClass = 'percentage-low';
                } else if (recordRate < 92) {
                    rateClass = 'percentage-medium';
                }
                
                rowsHTML += `
                    <tr>
                        <td>${stat.department}</td>
                        <td><strong>${stat.operator}</strong></td>
                        <td>${stat.totalOrders}</td>
                        <td>${stat.withRecords}</td>
                        <td>${stat.withoutRecords}</td>
                        <td class="percentage-cell ${rateClass}">${recordRate}%</td>
                        <td>${stat.avgDuration}åˆ†é’Ÿ</td>
                    </tr>
                `;
            });
            
            operatorBody.innerHTML = rowsHTML;
        }

        // æ›´æ–°ç»Ÿè®¡æ‘˜è¦
        function updateSummaryStats(stats, type) {
            const summaryElement = document.getElementById('statisticsSummary');
            
            if (stats.length === 0) {
                summaryElement.innerHTML = `
                    <div class="summary-card">
                        <div class="summary-title">ç»Ÿè®¡é¡¹æ•°</div>
                        <div class="summary-value">0</div>
                    </div>
                `;
                return;
            }
            
            const totalItems = stats.length;
            
            if (type === 'department') {
                const totalOrders = stats.reduce((sum, stat) => sum + stat.totalOrders, 0);
                const totalWithRecords = stats.reduce((sum, stat) => sum + stat.withRecords, 0);
                const totalWithoutRecords = stats.reduce((sum, stat) => sum + stat.withoutRecords, 0);
                const avgRecordRate = (totalWithRecords / totalOrders * 100).toFixed(1);
                
                summaryElement.innerHTML = `
                    
                    <div class="summary-card">
                        <div class="summary-title">æ€»å—ç†å•æ•°</div>
                        <div class="summary-value">${totalOrders}</div>
                    </div>
                    <div class="summary-card records">
                        <div class="summary-title">æœ‰æœåŠ¡ç•™ç—•æ•°</div>
                        <div class="summary-value">${totalWithRecords}</div>
                    </div>
                    <div class="summary-card empty">
                        <div class="summary-title">æ— æœåŠ¡ç•™ç—•æ•°</div>
                        <div class="summary-value">${totalWithoutRecords}</div>
                    </div>
                    <div class="summary-card">
                        <div class="summary-title">æ€»ä½“æœåŠ¡ç•™ç—•ç‡</div>
                        <div class="summary-value">${avgRecordRate}%</div>
                    </div>
                `;
            } else {
                const totalOrders = stats.reduce((sum, stat) => sum + stat.totalOrders, 0);
                const totalWithRecords = stats.reduce((sum, stat) => sum + stat.withRecords, 0);
                const totalWithoutRecords = stats.reduce((sum, stat) => sum + stat.withoutRecords, 0);
                const avgRecordRate = (totalWithRecords / totalOrders * 100).toFixed(1);
                const uniqueDepartments = [...new Set(stats.map(stat => stat.department))].length;
                
                summaryElement.innerHTML = `
                    <div class="summary-card operator">
                        <div class="summary-title">ç»Ÿè®¡æ“ä½œå‘˜æ•°</div>
                        <div class="summary-value">${totalItems}</div>
                    </div>
                    <div class="summary-card department">
                        <div class="summary-title">æ¶‰åŠéƒ¨é—¨æ•°</div>
                        <div class="summary-value">${uniqueDepartments}</div>
                    </div>
                    <div class="summary-card">
                        <div class="summary-title">æ€»å—ç†å•æ•°</div>
                        <div class="summary-value">${totalOrders}</div>
                    </div>
                    <div class="summary-card records">
                        <div class="summary-title">æœ‰æœåŠ¡ç•™ç—•æ•°</div>
                        <div class="summary-value">${totalWithRecords}</div>
                    </div>
                    <div class="summary-card empty">
                        <div class="summary-title">æ— æœåŠ¡ç•™ç—•æ•°</div>
                        <div class="summary-value">${totalWithoutRecords}</div>
                    </div>
                    <div class="summary-card">
                        <div class="summary-title">æ€»ä½“æœåŠ¡ç•™ç—•ç‡</div>
                        <div class="summary-value">${avgRecordRate}%</div>
                    </div>
                `;
            }
        }

        // å…³é—­æ¨¡æ€æ¡†
        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
        }

        // é‡ç½®è¡¨å•
        function resetForm() {
            document.getElementById('address').value = '';
            document.getElementById('department').value = '';
            document.getElementById('operator').value = '';
            document.getElementById('startDate').value = '2025-10-01';
            document.getElementById('endDate').value = '2025-10-31';
            
            // æ˜¾ç¤ºéƒ¨é—¨ç»Ÿè®¡è¡¨æ ¼
            document.getElementById('departmentTable').style.display = 'table';
            document.getElementById('operatorTable').style.display = 'none';
            
            // æ˜¾ç¤ºæ‰€æœ‰ç»Ÿè®¡æ•°æ®
            displayDepartmentStats(mockStatisticsData.departmentStats);
            updateSummaryStats(mockStatisticsData.departmentStats, 'department');
        }

        // ç‚¹å‡»æ¨¡æ€æ¡†èƒŒæ™¯å…³é—­
        document.getElementById('treeModal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeModal('treeModal');
            }
        });
    </script>
</body>
</html>